(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function o(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(a){if(a.ep)return;a.ep=!0;const r=o(a);fetch(a.href,r)}})();const A=function(){var e={},t,o=typeof GM_getValue<"u"&&typeof GM_setValue<"u";function n(c,l){t=l,e=c,typeof GM_registerMenuCommand<"u"&&GM_registerMenuCommand("Settings",function(){A.showSettingsWindow()}),o&&Object.keys(e).forEach(d=>{e[d].value=GM_getValue(d,e[d].default)})}function a(){const c=document.createElement("div");c.className="userscript-settings-modal-window";const l=document.createElement("span");l.className="userscript-settings-modal-close",l.innerHTML="&times;",l.onclick=()=>document.body.removeChild(c),c.appendChild(l);const d=document.createElement("table");d.className="userscript-settings-modal-table";const f=document.createElement("tr");f.innerHTML="<th>Setting</th><th>Value</th>",d.appendChild(f),Object.keys(e).forEach(p=>{const E=document.createElement("tr"),m=document.createElement("td");m.className="userscript-settings-tooltip-cell",m.setAttribute("data-tooltip",e[p].description),m.textContent=e[p].label,E.appendChild(m);const v=document.createElement("td");if(typeof e[p].value=="boolean"){const s=document.createElement("input");s.type="checkbox",s.checked=e[p].value,s.onchange=()=>A.update(p,s.checked),v.appendChild(s)}else{const s=document.createElement("input");s.type="number",s.value=e[p].value,s.onchange=()=>A.update(p,Number(s.value)),v.appendChild(s)}E.appendChild(v),d.appendChild(E)}),c.appendChild(d),document.body.appendChild(c)}function r(c,l){e[c].value=l,o&&GM_setValue(c,l),t(c,l)}function u(){Object.keys(e).forEach(c=>{A.update(c,e[c].default)})}return{init:n,showSettingsWindow:a,update:r,restoreDefault:u}}();/**
 * @license lucide v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=([e,t,o])=>{const n=document.createElementNS("http://www.w3.org/2000/svg",e);return Object.keys(t).forEach(a=>{n.setAttribute(a,String(t[a]))}),o!=null&&o.length&&o.forEach(a=>{const r=B(a);n.appendChild(r)}),n},M=(e,t={})=>{const o="svg",n={...T,...t};return B([o,n,e])};/**
 * @license lucide v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17"}]];/**
 * @license lucide v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"}],["path",{d:"M3 3v5h5"}]];/**
 * @license lucide v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7"}]];/**
 * @license lucide v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"}],["circle",{cx:"12",cy:"12",r:"3"}]];/**
 * @license lucide v0.483.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const I=[["path",{d:"M3 6h18"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17"}]],g={ALLOW_DEBUG:{description:"Allow debug messages in the console",label:"Enable Debugging",value:!0,default:!0},AUTOSAVE_SECONDS_DELAY:{description:"Seconds between autosaving the current copy",label:"Autosave Delay (seconds)",value:30,default:30},AUTOARCHIVE_MINUTES_DELAY:{description:"Minutes between archiving copies",label:"Auto-Archive Delay (minutes)",value:1,default:1},MAX_ARCHIVED:{description:"Maximum number of archived copies before older ones are removed",label:"Max Archived Copies",value:30,default:30},PLACE_NEAR_TEXTAREA:{description:"Whether to place the panel near the textarea or in the window corner",label:"Place Panel Near Textarea",value:!0,default:!0}},i=document.querySelector("textarea#message");var b,h,_,y,w=[];function R(){if(A.init(g,V),!i)return g.ALLOW_DEBUG.value&&console.warn("phpBBForumAutosaver:","No textareas with proper ID found on that page"),0;let e=F();if(e)h="PhpBBForumAutosaver-"+e+"_old",b="PhpBBForumAutosaver-"+e+"_current";else return 0;H(i),U(),_=setInterval(()=>{S()},g.AUTOSAVE_SECONDS_DELAY.value*1e3),y=setInterval(()=>{L()},g.AUTOARCHIVE_MINUTES_DELAY.value*1e3*60)}function V(e,t){e==="AUTOSAVE_SECONDS_DELAY"&&(clearInterval(_),_=setInterval(()=>{S()},t*1e3)),e==="AUTOARCHIVE_MINUTES_DELAY"&&(clearInterval(y),y=setInterval(()=>{L()},t*1e3*60))}function F(){const e=new URL(window.location.href);if(e.hostname==="localhost"||e.hostname==="127.0.0.1")return"localhost_devTest";let t=e.searchParams.get("t");if(!t){const n=/\/[^,]+,(\d+)\.html$/,a=e.pathname.match(n);a&&(t=a[1])}if(t)return`topicReply_${t}`;const o=e.searchParams.get("mode");if(!o)return console.warn("phpBBForumAutosaver:","Textarea found, but can't create ID for this url"),0;if(o==="post")return`newTopicOnSubforum_${e.searchParams.get("f")}`;if(o==="compose"){let n=e.searchParams.get("p");return n?`ReplyPM_${n}`:"NewPM"}return console.warn("phpBBForumAutosaver:","Textarea found, but can't create ID for this url, unknown mode"),0}function H(e){const t=document.createElement("div");if(t.id="PhpBBForumAutosaver_Panel",[{icon:O,tooltip:"Manually save post",name:"save",onClick:G},{icon:N,tooltip:"Load last saved post",name:"loadLast",onClick:$},{icon:D,tooltip:"Load copy - choose from saved versions",name:"loadAny",onClick:k},{icon:I,tooltip:"Delete all saved copies for this draft",name:"delete",onClick:W,spacing:!0},{icon:P,tooltip:"Settings",name:"settings",onClick:Y,spacing:!0}].forEach(({icon:n,tooltip:a,name:r,onClick:u,spacing:c})=>{const l=document.createElement("div");l.className="icon-btn",l.id=`btn_${r}`,l.setAttribute("data-tooltip",a),l.onclick=u,c&&(l.style.marginTop="20px");const d=M(n);l.appendChild(d),t.appendChild(l),w.push(l)}),console.log(g.PLACE_NEAR_TEXTAREA),g.PLACE_NEAR_TEXTAREA.value===!0){let n=e.getBoundingClientRect();t.style.left=`${n.left+window.scrollX-30}px`,t.style.top=`${n.top+window.scrollY+100}px`,t.style.position="absolute"}else t.style.left="20px",t.style.top="8rem",t.style.position="fixed";return document.body.appendChild(t),t}function U(){let e=localStorage.getItem(b),t=JSON.parse(localStorage.getItem(h));i.value===""&&(e?i.value=e:t&&(i.value=t.archived.at(-1).text))}function L(){let e=w.find(r=>r.id==="btn_loadAny");if(i.value===""||i.value.length<10)return;let t=JSON.parse(localStorage.getItem(h)),o;if(t){if(t.archived.at(-1).text===i.value){C(e,"yellow",2e3);return}o=t.archived,o.length>=g.MAX_ARCHIVED.value&&o.shift()}else o=[];let n=new Date;o.push({date:n,text:i.value});let a={lastArchived:n,archived:o};localStorage.setItem(h,JSON.stringify(a)),C(e,"green",5e3)}function S(){if(i.value===""||i.value.length<10)return;localStorage.setItem(b,i.value);let e=w.find(t=>t.id==="btn_save");C(e,"green",2e3)}function G(){S()}function $(){let e=localStorage.getItem(b),t=w.find(o=>o.id==="btn_loadLast");e?(i.value=e,C(t,"green",3e3)):(C(t,"red",2e3),console.warn("PhpBBForumAutosaver:","no saved draft yet"))}function Y(){A.showSettingsWindow()}function k(){let e=JSON.parse(localStorage.getItem(h));e&&e.archived&&x(e.archived)}function W(){confirm("Do you really want to DELETE all drafts for this page?")&&(localStorage.removeItem(b),localStorage.removeItem(h),alert("All drafts deleted."))}function C(e,t,o){let n=e.style.color;e.style.color=t,setTimeout(()=>{e.style.color=n},o)}function x(e){const t=document.createElement("div");t.className="modal-window";const o=document.createElement("div");o.className="modal-close",o.innerHTML="&times;",o.onclick=()=>document.body.removeChild(t),t.appendChild(o);const n=document.createElement("div");n.className="modal-table-container",e.length>7&&(n.style.maxHeight="300px",n.style.overflowY="auto");const a=document.createElement("table");a.className="modal-table";const r=a.createTHead().insertRow();["Date","Text","Action","Delete"].forEach(c=>{const l=document.createElement("th");l.textContent=c,r.appendChild(l)});const u=a.createTBody();e.forEach(({date:c,text:l},d)=>{const f=u.insertRow();f.insertCell().textContent=new Date(c).toLocaleString();const p=l.split(`
`)[0]||"",E=l.split(`
`).slice(-1)[0]||"";f.insertCell().textContent=`${p} (...) ${E}`;const m=document.createElement("button");m.textContent="Load",m.onclick=()=>{i.value=l,document.body.removeChild(t)},f.insertCell().appendChild(m);const v=document.createElement("button"),s=M(I);v.appendChild(s),v.onclick=()=>{confirm("Do you really want to DELETE this version?")&&(document.body.removeChild(t),j(c))},f.insertCell().appendChild(v)}),n.appendChild(a),t.appendChild(n),document.body.appendChild(t)}function j(e){let t=JSON.parse(localStorage.getItem(h)),o=t.archived.findIndex(n=>n.date===e);o!==-1?(t.archived.splice(o,1),localStorage.setItem(h,JSON.stringify(t))):console.warn("PhpBBForumAutosaver:","cant delete archived copy, something went wrong"),x(t.archived)}R();
